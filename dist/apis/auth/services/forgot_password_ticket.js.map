{"version":3,"sources":["../source/apis/auth/services/forgot_password_ticket.js"],"names":["generatePasswordResetRequest","userId","PasswordResetRequests","currentTime","Date","deleteMany","expiresAt","$lte","now","env","FORGOT_PASSWORD_URL_EXPIRY","request","findOneAndUpdate","code","upsert","new"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;AACA;;;;AAEe,eAAeA,4BAAf,CAA4CC,MAA5C,EAAoD;AACjE,QAAMC,qBAAqB,GAAG,oCAA9B;AACA,QAAMC,WAAW,GAAG,IAAIC,IAAJ,EAApB;AACA,QAAMF,qBAAqB,CAACG,UAAtB,CAAiC;AAAEC,IAAAA,SAAS,EAAE;AAAEC,MAAAA,IAAI,EAAEJ;AAAR;AAAb,GAAjC,CAAN;AACA,QAAMG,SAAS,GAAG,IAAIF,IAAJ,CAASA,IAAI,CAACI,GAAL,KAAa,iBAAGC,aAAIC,0BAAP,CAAtB,CAAlB;AACA,QAAMC,OAAO,GAAG,MAAMT,qBAAqB,CAACU,gBAAtB,CACpB;AAAEX,IAAAA;AAAF,GADoB,EAEpB;AACEA,IAAAA,MADF;AAEEK,IAAAA,SAFF;AAGEO,IAAAA,IAAI,EAAE;AAHR,GAFoB,EAOpB;AAAEC,IAAAA,MAAM,EAAE,IAAV;AAAgBC,IAAAA,GAAG,EAAE;AAArB,GAPoB,CAAtB;AASA,SAAOJ,OAAP;AACD","sourcesContent":["import { uuid } from 'uuidv4';\nimport ms from 'ms';\nimport PasswordResetRequestModel from '../models/passwordresetrequest';\nimport env from '../../../config/env';\n\nexport default async function generatePasswordResetRequest(userId) {\n  const PasswordResetRequests = PasswordResetRequestModel();\n  const currentTime = new Date();\n  await PasswordResetRequests.deleteMany({ expiresAt: { $lte: currentTime } });\n  const expiresAt = new Date(Date.now() + ms(env.FORGOT_PASSWORD_URL_EXPIRY));\n  const request = await PasswordResetRequests.findOneAndUpdate(\n    { userId },\n    {\n      userId,\n      expiresAt,\n      code: uuid(),\n    },\n    { upsert: true, new: true }\n  );\n  return request;\n}\n"],"file":"forgot_password_ticket.js"}